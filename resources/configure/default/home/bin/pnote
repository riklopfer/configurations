#!/usr/bin/env bash
if [[ -z $1 ]]; then
    echo "USAGE: pnote <some message>"
    echo "Send notification via Pushover"
    exit 1
fi
MESSAGE="$@"

APP_PASS=pushover/pnote
USER_PASS=pushover/user

get_password() {
    if [ $1 ]; then
        pass show --clip $1 >& /dev/null
        xclip -o -selection clipboard
    fi
}


if [ -z $PNOTE_TOK ] || [ -z $PO_USER_TOK ]; then 
    if ! hash pass >& /dev/null ; then
        echo "'pass' not installed. Please install and configure $APP_PASS and $USER_PASS"
        exit 1
    fi
    PNOTE_TOK=$(get_password $APP_PASS)
    PO_USER_TOK=$(get_password $USER_PASS) 
fi

curl -s \
    -F "token=$PNOTE_TOK" \
    -F "user=$PO_USER_TOK" \
    -F "message=$MESSAGE" \
    -F "title=$HOSTNAME" \
    https://api.pushover.net/1/messages > /dev/null
